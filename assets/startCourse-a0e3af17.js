import{i as m,h,u as c,a as n,g,r as f}from"./backtotop-61d0d527.js";let i;const u=Swal.mixin({icon:"success",toast:!0,position:"top-end",showConfirmButton:!1,timer:1500});let d,y,p,l;function x(e){document.addEventListener("DOMContentLoaded",()=>{e.addEventListener("click",async t=>{if(t.target.dataset.course&&t.target.type==="button")if(m){i=t.target.dataset.course;const a=Number(t.target.dataset.quantity)||1;await C(),l=y.find(o=>o.couponId==p[0].id)!==void 0,D(a),k(),j()}else h()})})}async function C(){try{const e=`https://project-code-json-k0ti.onrender.com/myCarts?userId=${c}&courseId=${i}&status=purchase`,t=`https://project-code-json-k0ti.onrender.com/myCoupons?userId=${c}`,a=`https://project-code-json-k0ti.onrender.com/coupons?courseId=${i}`,o=await Promise.all([n.get(e),n.get(t),n.get(a)]);d=o[0].data,y=o[1].data,p=o[2].data}catch{console.log("getStartCourseData",C)}}async function j(){l?u.fire({title:"將課程加入購物車"}):(await u.fire({title:"將課程加入購物車"}),u.fire({title:"首次加入購物車，獲得「體驗課優惠券」、「多堂折價優惠券」"}))}function D(e){d.length?$(d[0],e):w(e)}async function w(e){try{const t={userId:c,courseId:i,quantity:e,status:"purchase",isNextPurchase:!1,dueDate:""};await n.post("https://project-code-json-k0ti.onrender.com/myCarts",t,{headers:{"Content-Type":"application/json"}}),await g(),f()}catch(t){console.log("getMyCarts",t)}}async function $(e,t){try{let{id:a,quantity:o,isNextPurchase:s}=e,r={};s?r={isNextPurchase:!1,quantity:t===1?o:t}:(o=Number(o)+1,r={quantity:t===1?o++:t}),await n.patch(`https://project-code-json-k0ti.onrender.com/myCarts/${a}`,r,{headers:{"Content-Type":"application/json"}})}catch(a){console.log("getMyCarts",a)}}async function k(){if(!l)try{await Promise.all(p.map(e=>I(e)))}catch(e){console.error("Error adding coupons:",e)}}async function I(e){try{let t=e.id,a=e.discountCourseNum*7,o=Date.now(),s=new Date(o);s.setDate(s.getDate()+a),s.setHours(23,59,59,999);let r={userId:c,couponId:t,canUse:!0,timestamp:o,dueDate:s};await n.post("https://project-code-json-k0ti.onrender.com/myCoupons",r,{headers:{"Content-Type":"application/json"}})}catch(t){console.log("addCoupon",t)}}export{x as h};
